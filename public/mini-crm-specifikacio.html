<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini CRM - Teljes Rendszer Specifikáció</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }
        
        h3 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e8f4f8;
        }
        
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .status-box {
            display: inline-block;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            width: 100%;
        }
        
        .implemented {
            background-color: #d4edda;
            border-left: 5px solid #28a745;
        }
        
        .not-implemented {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
        }
        
        .partial {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
        }
        
        .status-icon {
            font-size: 1.2em;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .green { color: #28a745; }
        .red { color: #dc3545; }
        .orange { color: #ffc107; }
        
        .info-box {
            background-color: #e7f3ff;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .section {
            page-break-inside: avoid;
        }
        
        @media print {
            body {
                padding: 20px;
            }
            
            .status-box {
                page-break-inside: avoid;
            }
        }
        
        .feature-list {
            list-style: none;
            margin-left: 0;
        }
        
        .feature-list li {
            padding-left: 30px;
            position: relative;
        }
        
        .feature-list li::before {
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }
        
        .feature-list li.done::before {
            content: "✓";
            color: #28a745;
        }
        
        .feature-list li.missing::before {
            content: "✗";
            color: #dc3545;
        }
        
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .tech-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .tech-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Mini CRM - Teljes Rendszer Specifikáció</h1>
    
    <div class="info-box">
        <strong>Dokumentum információk:</strong><br>
        Verzió: 1.0<br>
        Utolsó frissítés: 2025-11-30<br>
        Projekt típus: Mini CRM rendszer<br>
        Technológia: React + TypeScript + Lovable Cloud (Supabase)
    </div>

    <div class="section">
        <h2>1. RENDSZER ÁTTEKINTÉS</h2>
        
        <h3>1.1. Technológiai Stack <span class="status-icon green">✓</span></h3>
        <div class="tech-stack">
            <div class="tech-item">
                <strong>Frontend</strong>
                React 18 + TypeScript + Vite
            </div>
            <div class="tech-item">
                <strong>UI Framework</strong>
                Tailwind CSS + shadcn/ui
            </div>
            <div class="tech-item">
                <strong>Backend</strong>
                Lovable Cloud (Supabase)
            </div>
            <div class="tech-item">
                <strong>Adatbázis</strong>
                PostgreSQL (Supabase)
            </div>
            <div class="tech-item">
                <strong>Autentikáció</strong>
                Supabase Auth + TOTP 2FA
            </div>
            <div class="tech-item">
                <strong>Edge Functions</strong>
                Deno Runtime
            </div>
            <div class="tech-item">
                <strong>Nyelvi Támogatás</strong>
                i18next (magyar, angol)
            </div>
        </div>
        
        <h3>1.2. Fő Modulok</h3>
        <ul class="feature-list">
            <li class="done">Felhasználó- és jogosultságkezelés</li>
            <li class="done">Vállalatkezelés + licencrendszer</li>
            <li class="done">Partnerkezelés</li>
            <li class="done">Értékesítések (Sales)</li>
            <li class="done">Projektmenedzsment</li>
            <li class="done">Feladatkezelés</li>
            <li class="done">Dokumentumkezelés (metadata only)</li>
            <li class="done">Költségkezelés</li>
            <li class="done">Naptár (task-based)</li>
            <li class="done">Törzsadatok (Master Data)</li>
            <li class="done">Naplózás (Audit Logs)</li>
            <li class="done">Rendszerbeállítások</li>
        </ul>
    </div>

    <div class="section">
        <h2>2. ADATBÁZIS STRUKTÚRA <span class="status-icon green">✓</span></h2>
        
        <h3>2.1. Felhasználók és Autentikáció</h3>
        
        <h4>profiles (felhasználói profilok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>→ auth.users</td></tr>
                <tr><td>email</td><td>text</td><td>Email cím</td></tr>
                <tr><td>full_name</td><td>text</td><td>Teljes név</td></tr>
                <tr><td>given_name, family_name</td><td>text</td><td>Keresztnév, vezetéknév</td></tr>
                <tr><td>user_code</td><td>text</td><td>Egyedi felhasználói kód</td></tr>
                <tr><td>role</td><td>user_role ENUM</td><td>super_admin, admin, normal, viewer</td></tr>
                <tr><td>is_active</td><td>boolean</td><td>Aktív státusz</td></tr>
                <tr><td>language</td><td>text</td><td>en/hu</td></tr>
                <tr><td>default_company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>must_change_password</td><td>boolean</td><td>Kötelező jelszóváltoztatás</td></tr>
                <tr><td>can_delete, can_view_logs</td><td>boolean</td><td>Globális jogosultságok</td></tr>
                <tr><td>two_factor_enabled</td><td>boolean</td><td>2FA bekapcsolva</td></tr>
                <tr><td>two_factor_secret</td><td>text</td><td>TOTP titkos kulcs</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>user_recovery_codes (2FA backup kódok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ auth.users</td></tr>
                <tr><td>code_hash</td><td>text</td><td>SHA-256 hash</td></tr>
                <tr><td>used</td><td>boolean</td><td>Felhasznált-e</td></tr>
                <tr><td>used_at, created_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>session_2fa_verifications (2FA session ellenőrzések) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ auth.users</td></tr>
                <tr><td>session_id</td><td>text</td><td>JWT session azonosító</td></tr>
                <tr><td>verified_at</td><td>timestamptz</td><td>Ellenőrzés időpontja</td></tr>
                <tr><td>expires_at</td><td>timestamptz</td><td>Lejárati idő (konfiguráható)</td></tr>
                <tr><td colspan="3"><em>UNIQUE(user_id, session_id)</em></td></tr>
            </tbody>
        </table>

        <h4>login_attempts (bejelentkezési kísérletek) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>email</td><td>text</td><td>Email cím</td></tr>
                <tr><td>user_id</td><td>uuid (nullable, FK)</td><td>→ auth.users</td></tr>
                <tr><td>success</td><td>boolean</td><td>Sikeres-e</td></tr>
                <tr><td>attempt_time</td><td>timestamptz</td><td>Kísérlet időpontja</td></tr>
                <tr><td>ip_address, user_agent</td><td>text</td><td>Kliens információk</td></tr>
            </tbody>
        </table>

        <h4>locked_accounts (zárolt fiókok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ auth.users</td></tr>
                <tr><td>locked_at</td><td>timestamptz</td><td>Zárolás időpontja</td></tr>
                <tr><td>locked_until</td><td>timestamptz (nullable)</td><td>Zárolás vége (NULL = permanent)</td></tr>
                <tr><td>locked_by_system</td><td>boolean</td><td>Automatikus zárolás-e</td></tr>
                <tr><td>unlocked_at</td><td>timestamptz</td><td>Feloldás időpontja</td></tr>
                <tr><td>unlocked_by</td><td>uuid (FK)</td><td>→ profiles (ki oldotta fel)</td></tr>
                <tr><td>reason</td><td>text</td><td>Zárolás oka</td></tr>
            </tbody>
        </table>

        <h4>two_factor_attempts (2FA próbálkozások) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ auth.users</td></tr>
                <tr><td>attempted_at</td><td>timestamptz</td><td>Próbálkozás időpontja</td></tr>
                <tr><td>success</td><td>boolean</td><td>Sikeres-e</td></tr>
                <tr><td>ip_address</td><td>text</td><td>Kliens IP</td></tr>
            </tbody>
        </table>

        <h4>two_factor_locks (2FA átmeneti zárolások) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>user_id</td><td>uuid (PK, FK)</td><td>→ auth.users</td></tr>
                <tr><td>locked_at</td><td>timestamptz</td><td>Zárolás kezdete</td></tr>
                <tr><td>locked_until</td><td>timestamptz</td><td>Zárolás vége</td></tr>
                <tr><td>reason</td><td>text</td><td>Zárolás oka</td></tr>
            </tbody>
        </table>

        <h3>2.2. Vállalatok és Jogosultságok</h3>

        <h4>companies (vállalatok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>name</td><td>text</td><td>Vállalat neve</td></tr>
                <tr><td>tax_id</td><td>text</td><td>Adószám</td></tr>
                <tr><td>address</td><td>text</td><td>Cím</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>company_licenses (vállalathoz tartozó licenc) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>company_id</td><td>uuid (FK, UNIQUE)</td><td>→ companies</td></tr>
                <tr><td>license_key</td><td>text</td><td>Auto-generált kulcs (LIC-XXXXX-...)</td></tr>
                <tr><td>max_users</td><td>integer</td><td>Licencelt felhasználók száma</td></tr>
                <tr><td>valid_from, valid_until</td><td>timestamptz</td><td>Érvényességi időszak</td></tr>
                <tr><td>is_active</td><td>boolean</td><td>Manuális aktiválás/deaktiválás</td></tr>
                <tr><td>features</td><td>jsonb</td><td>["partners", "sales", "projects", ...]</td></tr>
                <tr><td>created_at, updated_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>user_companies (felhasználó-vállalat kapcsolat) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ profiles</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>created_at</td><td>timestamptz</td><td>Hozzárendelés időpontja</td></tr>
            </tbody>
        </table>

        <h4>user_company_permissions (jogosultságok vállalatonként) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ profiles</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>role</td><td>company_role ENUM</td><td>ADMIN, NORMAL, VIEWER</td></tr>
                <tr><td>can_delete</td><td>boolean</td><td>Törlési jog</td></tr>
                <tr><td>can_edit_master_data</td><td>boolean</td><td>Törzsadat szerkesztés</td></tr>
                <tr><td>can_view_logs</td><td>boolean</td><td>Napló megtekintés</td></tr>
                <tr><td>created_at, updated_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h3>2.3. Üzleti Entitások</h3>

        <h4>partners (partnerek) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>name</td><td>text</td><td>Partner neve</td></tr>
                <tr><td>tax_id, address, email, phone</td><td>text</td><td>Elérhetőségek</td></tr>
                <tr><td>category</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>notes</td><td>text</td><td>Megjegyzések</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>sales (értékesítések) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>partner_id</td><td>uuid (FK)</td><td>→ partners</td></tr>
                <tr><td>name</td><td>text</td><td>Értékesítés neve</td></tr>
                <tr><td>description</td><td>text</td><td>Leírás</td></tr>
                <tr><td>status</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>business_unit</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>expected_value</td><td>numeric</td><td>Várható érték</td></tr>
                <tr><td>currency</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>expected_close_date</td><td>date</td><td>Várható lezárás</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>projects (projektek) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>code</td><td>text</td><td>Projekt azonosító</td></tr>
                <tr><td>name</td><td>text</td><td>Projekt neve</td></tr>
                <tr><td>description</td><td>text</td><td>Leírás</td></tr>
                <tr><td>status</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>owner_user_id</td><td>uuid (FK)</td><td>→ profiles (tulajdonos)</td></tr>
                <tr><td>responsible1_user_id, responsible2_user_id</td><td>uuid (FK)</td><td>→ profiles (felelősök)</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>tasks (feladatok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>project_id</td><td>uuid (FK, nullable)</td><td>→ projects</td></tr>
                <tr><td>sales_id</td><td>uuid (FK, nullable)</td><td>→ sales</td></tr>
                <tr><td>title</td><td>text</td><td>Feladat címe</td></tr>
                <tr><td>description</td><td>text</td><td>Leírás</td></tr>
                <tr><td>status</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>responsible_user_id</td><td>uuid (FK)</td><td>→ profiles (felelős)</td></tr>
                <tr><td>created_by</td><td>uuid (FK)</td><td>→ profiles (létrehozó)</td></tr>
                <tr><td>deadline</td><td>date</td><td>Határidő</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>documents (dokumentumok) <span class="status-icon orange">⚠</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>owner_company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>partner_id</td><td>uuid (FK, nullable)</td><td>→ partners</td></tr>
                <tr><td>project_id</td><td>uuid (FK, nullable)</td><td>→ projects</td></tr>
                <tr><td>sales_id</td><td>uuid (FK, nullable)</td><td>→ sales</td></tr>
                <tr><td>title</td><td>text</td><td>Dokumentum címe</td></tr>
                <tr><td>description</td><td>text</td><td>Leírás</td></tr>
                <tr><td>visibility</td><td>text</td><td>private/shared</td></tr>
                <tr><td>file_path, file_size, mime_type</td><td>text/integer</td><td>Fájl metaadatok</td></tr>
                <tr><td>uploaded_by</td><td>uuid (FK)</td><td>→ profiles</td></tr>
                <tr><td>uploaded_at</td><td>timestamptz</td><td>Feltöltés időpontja</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>
        <div class="warning-box">
            <strong>⚠️ Részleges implementáció:</strong> Csak metadata tárolás, nincs Supabase Storage integráció (file_path empty, nincs upload/download funkció).
        </div>

        <h4>costs (költségek) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>project_id</td><td>uuid (FK)</td><td>→ projects</td></tr>
                <tr><td>cost_date</td><td>date</td><td>Költség dátuma</td></tr>
                <tr><td>amount</td><td>numeric</td><td>Összeg</td></tr>
                <tr><td>currency</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>category</td><td>text</td><td>master_data ref</td></tr>
                <tr><td>quantity</td><td>numeric</td><td>Mennyiség</td></tr>
                <tr><td>rate</td><td>numeric</td><td>Árfolyam</td></tr>
                <tr><td>amount_huf</td><td>numeric</td><td>Összeg HUF-ban (calculated)</td></tr>
                <tr><td>exchange_rate_id</td><td>uuid (FK)</td><td>→ exchange_rates</td></tr>
                <tr><td>created_at, updated_at, deleted_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>exchange_rates (árfolyamok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>currency_from</td><td>text</td><td>Forrás deviza</td></tr>
                <tr><td>currency_to</td><td>text</td><td>Cél deviza (default 'HUF')</td></tr>
                <tr><td>rate</td><td>numeric</td><td>Árfolyam</td></tr>
                <tr><td>rate_date</td><td>date</td><td>Árfolyam dátuma</td></tr>
                <tr><td>created_at</td><td>timestamptz</td><td>Létrehozás időpontja</td></tr>
            </tbody>
        </table>

        <h3>2.4. Rendszer Táblák</h3>

        <h4>master_data (törzsadatok) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>type</td><td>text</td><td>partner_category, project_status, task_status, ...</td></tr>
                <tr><td>value</td><td>text</td><td>Kulcs</td></tr>
                <tr><td>label</td><td>text</td><td>Megjelenítendő szöveg</td></tr>
                <tr><td>order_index</td><td>integer</td><td>Sorrend</td></tr>
                <tr><td>is_default</td><td>boolean</td><td>Alapértelmezett-e</td></tr>
                <tr><td>created_at, updated_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <h4>logs (audit napló) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>user_id</td><td>uuid (FK)</td><td>→ profiles</td></tr>
                <tr><td>company_id</td><td>uuid (FK)</td><td>→ companies</td></tr>
                <tr><td>entity_type</td><td>text</td><td>partner, project, sale, ...</td></tr>
                <tr><td>entity_id</td><td>uuid</td><td>Entitás azonosító</td></tr>
                <tr><td>action</td><td>text</td><td>create, update, delete</td></tr>
                <tr><td>previous_values, new_values</td><td>jsonb</td><td>Előző és új értékek</td></tr>
                <tr><td>created_at</td><td>timestamptz</td><td>Művelet időpontja</td></tr>
            </tbody>
        </table>

        <h4>system_settings (rendszerbeállítások) <span class="status-icon green">✓</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Mező</th>
                    <th>Típus</th>
                    <th>Leírás</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>id</td><td>uuid (PK)</td><td>Elsődleges kulcs</td></tr>
                <tr><td>setting_key</td><td>text (UNIQUE)</td><td>Beállítás kulcsa</td></tr>
                <tr><td>setting_value</td><td>text</td><td>Beállítás értéke</td></tr>
                <tr><td>description</td><td>text</td><td>Leírás</td></tr>
                <tr><td>created_at, updated_at</td><td>timestamptz</td><td>Időbélyegzők</td></tr>
            </tbody>
        </table>

        <div class="info-box">
            <strong>Kulcs beállítások:</strong><br>
            • <code>account_lock_attempts = 5</code><br>
            • <code>account_lock_auto_unlock_minutes = 30</code><br>
            • <code>account_lock_failed_attempts_window_minutes = 15</code><br>
            • <code>two_factor_session_duration_minutes = 720</code><br>
            • <code>two_factor_max_attempts = 10</code><br>
            • <code>two_factor_window_minutes = 10</code><br>
            • <code>two_factor_lock_minutes = 10</code>
        </div>
    </div>

    <div class="section">
        <h2>3. JOGOSULTSÁGI MODELL <span class="status-icon green">✓</span></h2>

        <h3>3.1. Globális Szerepkörök (profiles.role)</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>super_admin:</strong><br>
            • Teljes hozzáférés minden vállalathoz és funkcióhoz<br>
            • Felhasználók létrehozása/törlése<br>
            • Rendszerbeállítások módosítása<br>
            • Vállalatok és licencek kezelése<br>
            • Audit log megtekintése<br>
            • Zárolt fiókok feloldása
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>admin:</strong><br>
            • Hozzáférés a saját vállalataihoz (user_companies)<br>
            • Vállalatspecifikus jogosultságok (user_company_permissions)<br>
            • Licenc limitek betartása
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>normal:</strong><br>
            • Alapértelmezett felhasználó<br>
            • Vállalatspecifikus jogosultságok szerint
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>viewer:</strong><br>
            • Csak olvasási jog<br>
            • Nem számít bele a licenc seat limitbe
        </div>

        <h3>3.2. Vállalat Szerepkörök (user_company_permissions.role)</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>ADMIN:</strong><br>
            • Vállalaton belül minden adat kezelése<br>
            • Felhasználók hozzárendelése/jogosultságok módosítása (vállalaton belül)<br>
            • Törzs adat szerkesztés (ha can_edit_master_data = true)
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>NORMAL:</strong><br>
            • Saját adatok + hozzárendelt entitások kezelése<br>
            • can_delete flag szerint törlési jog
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>VIEWER:</strong><br>
            • Csak olvasás<br>
            • Nem használ seat-et a licencből
        </div>

        <h3>3.3. Row Level Security (RLS)</h3>

        <div class="info-box">
            <strong>Minden védett tábla RLS pattern:</strong>
            <pre>-- SELECT policy
USING (
  is_super_admin(auth.uid()) 
  OR 
  (
    company_id IN (
      SELECT company_id 
      FROM user_companies 
      WHERE user_id = auth.uid()
    )
    AND is_2fa_verified(auth.uid())
  )
)</pre>
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>RLS alkalmazva a következő táblákon:</strong><br>
            companies, projects, sales, partners, documents, tasks, costs, master_data, exchange_rates, user_companies, user_company_permissions, profiles, login_attempts, locked_accounts, session_2fa_verifications, two_factor_attempts, two_factor_locks, user_recovery_codes, logs, system_settings
        </div>
    </div>

    <div class="section">
        <h2>4. AUTENTIKÁCIÓ ÉS BIZTONSÁG <span class="status-icon green">✓</span></h2>

        <h3>4.1. Login Flow</h3>

        <ol>
            <li><strong>Email + Password</strong> → Supabase Auth</li>
            <li><strong>Ha 2FA enabled:</strong>
                <ul>
                    <li>RLS blokkolja az adatokat (<code>is_2fa_verified = false</code>)</li>
                    <li>2FA dialog megjelenik</li>
                    <li>User beírja a TOTP vagy recovery kódot</li>
                    <li><code>verify-2fa-token</code> edge function validál</li>
                    <li>Sikeres validáció → <code>session_2fa_verifications</code> írás (service role)</li>
                    <li>RLS átengedi az adatokat</li>
                </ul>
            </li>
            <li><strong>Ha 2FA disabled:</strong> azonnal hozzáférés</li>
        </ol>

        <h3>4.2. Account Lockout <span class="status-icon green">✓</span></h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>Mechanizmus:</strong><br>
            • <code>account_lock_attempts</code> (default 5) sikertelen login → lock<br>
            • <code>account_lock_failed_attempts_window_minutes</code> (15 perc) időablakban<br>
            • Lock időtartam: <code>account_lock_auto_unlock_minutes</code> (30 perc)<br>
            • <code>locked_accounts</code> tábla nyilvántartás<br>
            • <code>notify-account-lock</code> edge function email küldésre (placeholder)
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>Feloldás:</strong><br>
            • Automatikus (időalapú)<br>
            • Manuális (super_admin a Settings > Locked Accounts oldalon)
        </div>

        <h3>4.3. 2FA (TOTP + Recovery Codes) <span class="status-icon green">✓</span></h3>

        <h4>Setup <span class="status-icon green">✓</span></h4>
        <ol>
            <li>User: Settings > Two-Factor Authentication</li>
            <li>QR kód generálás (<code>generate_2fa_secret()</code>)</li>
            <li>Authenticator app párosítás</li>
            <li>Első token validáció → <code>enable_2fa()</code> + recovery kódok generálás</li>
            <li>10 db SHA-256 hashelt backup kód letöltése</li>
        </ol>

        <h4>Recovery Codes <span class="status-icon green">✓</span></h4>
        <ul>
            <li>Egyszeri használat (used flag)</li>
            <li>Jelszóváltoztatáskor nem invalidálódnak (szándékos design)</li>
            <li>Új kódok generálásakor a régiek törlődnek</li>
        </ul>

        <h4>Session Management <span class="status-icon green">✓</span></h4>
        <ul>
            <li>Session-alapú verification (<code>session_id</code> a JWT-ből)</li>
            <li>Konfiguráható lejárati idő (default 12h)</li>
            <li>Jelszóváltoztatáskor minden session invalidálódik</li>
            <li>2FA disable → minden session törlődik</li>
        </ul>

        <h4>Rate Limiting <span class="status-icon green">✓</span></h4>
        <ul>
            <li><code>two_factor_max_attempts</code> (10) próbálkozás</li>
            <li><code>two_factor_window_minutes</code> (10 perc) időablakban</li>
            <li>Lock: <code>two_factor_lock_minutes</code> (10 perc)</li>
            <li><code>two_factor_attempts</code> naplózás (IP-vel)</li>
        </ul>

        <h3>4.4. Password Policy <span class="status-icon green">✓</span></h3>

        <ul>
            <li>Min. 8 karakter</li>
            <li>Kis- és nagybetű</li>
            <li>Szám</li>
            <li>Speciális karakter</li>
            <li>Kötelező jelszóváltoztatás first login-nál (<code>must_change_password</code> flag)</li>
        </ul>
    </div>

    <div class="section">
        <h2>5. LICENCRENDSZER <span class="status-icon green">✓</span></h2>

        <h3>5.1. License Entitás</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>company_licenses (1-to-1 with companies):</strong><br>
            • <code>max_users</code>: licencelt seat-ek száma<br>
            • <code>valid_from</code>, <code>valid_until</code>: érvényességi időszak<br>
            • <code>is_active</code>: manuális aktiválás/deaktiválás<br>
            • <code>features</code>: jsonb array (enabled modulok)<br>
            • <code>license_key</code>: auto-generated (LIC-XXXXX-XXXXX-XXXXX-XXXXX-XXXX)
        </div>

        <h3>5.2. Seat Management <span class="status-icon green">✓</span></h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>Seat használók:</strong><br>
            • <code>user_company_permissions</code> ahol <code>role IN ('ADMIN', 'NORMAL')</code><br>
            • <code>profiles.is_active = true</code><br>
            • <code>profiles.role != 'super_admin'</code>
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>Enforcement:</strong><br>
            • <code>check_company_license_seat_limit()</code> trigger on <code>user_company_permissions</code><br>
            • <code>check_license_on_activate_user()</code> trigger on <code>profiles</code><br>
            • <code>can_add_seat(_company_id)</code> function
        </div>

        <h3>5.3. Trial License <span class="status-icon green">✓</span></h3>

        <ul>
            <li>Első vállalat automatikusan kap 14 napos trial-t</li>
            <li>5 seat limit</li>
            <li>Minden modul enabled</li>
            <li><code>create_trial_license_for_first_company()</code> trigger</li>
        </ul>

        <h3>5.4. License Activation <span class="status-icon green">✓</span></h3>

        <ol>
            <li>Super admin: License Generator oldal</li>
            <li>Kitölt egy form-ot (company, max_users, features, validity)</li>
            <li>Generál licenckulcsot → letölthető HTML</li>
            <li>Company admin: Settings > License Management</li>
            <li>License key beírása → <code>activate-license</code> edge function</li>
            <li>Validáció + aktiválás</li>
        </ol>
    </div>

    <div class="section">
        <h2>6. EDGE FUNCTIONS <span class="status-icon green">✓</span></h2>

        <h3>6.1. Authentication Functions</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>verify-2fa-token</strong><br>
            • Input: <code>{ token?: string, recoveryCode?: string }</code><br>
            • Authorization header required (JWT)<br>
            • Validates TOTP or recovery code<br>
            • Checks 2FA lock status<br>
            • Logs attempt<br>
            • On success: writes to <code>session_2fa_verifications</code> (service role)<br>
            • Returns: <code>{ valid: boolean, error?: string }</code>
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>generate-recovery-codes</strong><br>
            • Authorization header required<br>
            • Generates 10 new SHA-256 hashed codes<br>
            • Deletes old codes<br>
            • Returns plaintext codes (only once!)
        </div>

        <h3>6.2. User Management Functions (Admin Only)</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>admin-create-user</strong><br>
            • Creates auth.users + profiles<br>
            • Assigns to company + permissions<br>
            • Validates license seat limit<br>
            • Returns: user data + temp password
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>admin-update-user</strong><br>
            • Updates profile fields<br>
            • Cannot change role to super_admin (unless caller is SA)<br>
            • Validates license on role upgrade
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>admin-update-password</strong><br>
            • Service role password reset<br>
            • Sets <code>must_change_password = true</code>
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>admin-delete-user</strong><br>
            • Soft delete (<code>profiles.deleted_at</code>)<br>
            • Does not delete <code>auth.users</code> (Supabase limitation)
        </div>

        <h3>6.3. License Functions</h3>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>activate-license</strong><br>
            • Input: <code>{ company_id, license_key }</code><br>
            • Validates license key format + checksum<br>
            • Upserts company_licenses<br>
            • Returns: license details
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>validate-license</strong><br>
            • Input: <code>{ company_id }</code><br>
            • Checks: is_active, date range, seat usage<br>
            • Returns: validation result + details
        </div>

        <h3>6.4. Notification Functions</h3>

        <div class="status-box not-implemented">
            <span class="status-icon red">✗</span>
            <strong>notify-account-lock</strong><br>
            • Triggered on account lock (manual or automatic)<br>
            • Sends email to locked user<br>
            • <strong>Nincs implementálva:</strong> Email service konfiguráció hiányzik
        </div>
    </div>

    <div class="section">
        <h2>7. FRONTEND STRUKTURA <span class="status-icon green">✓</span></h2>

        <h3>7.1. Oldalak (Pages)</h3>

        <ul class="feature-list">
            <li class="done"><code>/</code> (Index) → redirect based on auth</li>
            <li class="done"><code>/auth</code> → Login + 2FA dialog</li>
            <li class="done"><code>/change-password</code> → Forced password change</li>
            <li class="done"><code>/dashboard</code> → Main dashboard</li>
            <li class="done"><code>/calendar</code> → Calendar view</li>
            <li class="done"><code>/partners</code> → Partner list + CRUD</li>
            <li class="done"><code>/sales</code> → Sales opportunities</li>
            <li class="done"><code>/projects</code> → Project management</li>
            <li class="done"><code>/documents</code> → Document repository</li>
            <li class="done"><code>/logs</code> → Audit logs (permission required)</li>
            <li class="done"><code>/settings</code> → System + User settings</li>
            <li class="done"><code>/license-generator</code> → License key generator (super_admin only)</li>
        </ul>

        <h3>7.2. Layout Components</h3>

        <ul class="feature-list">
            <li class="done"><strong>MainLayout:</strong> AppSidebar + TopBar + CompanyLicenseWarning</li>
            <li class="done"><strong>AppSidebar:</strong> Collapsible navigation (role-based, feature-based)</li>
            <li class="done"><strong>TopBar:</strong> Company selector, user menu, language selector</li>
            <li class="done"><strong>CompanyLicenseWarning:</strong> License expiration banner</li>
        </ul>

        <h3>7.3. Auth Components</h3>

        <ul class="feature-list">
            <li class="done"><code>Auth.tsx</code> → Login form + 2FA dialog</li>
            <li class="done"><code>TwoFactorDialog</code> → TOTP/recovery code input</li>
            <li class="done"><code>ForgotPasswordDialog</code> → Password reset flow</li>
        </ul>

        <h3>7.4. Settings Components</h3>

        <ul class="feature-list">
            <li class="done">User Settings: Profile edit, password change, 2FA management</li>
            <li class="done">System Settings (super_admin only): Account lock, 2FA settings</li>
            <li class="done">License Management: Current license, seat usage, activation</li>
            <li class="done">Locked Accounts (super_admin only): List + manual unlock</li>
        </ul>

        <h3>7.5. Hooks</h3>

        <ul class="feature-list">
            <li class="done"><strong>Authentication:</strong> useUserProfile, use2FA, useInactivityLogout</li>
            <li class="done"><strong>Authorization:</strong> useFeatureAccess, useLicenseEnforcement, useReadOnlyMode</li>
            <li class="done"><strong>Data:</strong> useCompanies, useUsers, usePartners, useMasterData, useUserCompanies, useCompanyLicenses</li>
            <li class="done"><strong>Security:</strong> useAccountLock, useLockedAccounts, useLoginAttempts</li>
        </ul>
    </div>

    <div class="section">
        <h2>8. I18N (INTERNATIONALIZATION) <span class="status-icon green">✓</span></h2>

        <h3>8.1. Nyelvek</h3>
        <ul>
            <li><strong>Magyar (hu)</strong> - default</li>
            <li><strong>English (en)</strong></li>
        </ul>

        <h3>8.2. Translation Files</h3>
        <ul>
            <li><code>src/locales/en.json</code> → UI strings</li>
            <li><code>src/locales/hu.json</code> → UI strings</li>
            <li><code>src/locales/masterdata-en.json</code> → Master data labels</li>
            <li><code>src/locales/masterdata-hu.json</code> → Master data labels</li>
        </ul>

        <h3>8.3. Language Selector</h3>
        <ul>
            <li>TopBar-ban dropdown</li>
            <li>User preference mentése (<code>profiles.language</code>)</li>
            <li>i18next + react-i18next</li>
            <li>Browser language detection fallback</li>
        </ul>
    </div>

    <div class="section">
        <h2>9. MASTER DATA (TÖRZSADATOK) <span class="status-icon green">✓</span></h2>

        <h3>9.1. Típusok</h3>
        <ul>
            <li><code>partner_category</code> → Partner kategóriák</li>
            <li><code>project_status</code> → Projekt státuszok</li>
            <li><code>task_status</code> → Feladat státuszok</li>
            <li><code>sale_status</code> → Értékesítés státuszok</li>
            <li><code>sale_business_unit</code> → Üzletági besorolás</li>
            <li><code>currency</code> → Devizák</li>
            <li><code>cost_category</code> → Költség kategóriák</li>
            <li><code>document_visibility</code> → Dokumentum láthatóság</li>
        </ul>

        <h3>9.2. Kezelés</h3>
        <ul>
            <li>Settings > Master Data Management</li>
            <li>Permission: <code>can_edit_master_data</code> flag</li>
            <li>i18n support (masterdata-*.json files)</li>
            <li>Order index (drag & drop sort - dnd-kit library)</li>
            <li>Default flag (checkbox)</li>
        </ul>
    </div>

    <div class="section">
        <h2>10. AUDIT LOG (NAPLÓZÁS) <span class="status-icon green">✓</span></h2>

        <h3>10.1. Naplózott Műveletek</h3>
        <ul>
            <li>Entitások: partner, project, sale, document, user, company, ...</li>
            <li>Műveletek: create, update, delete</li>
            <li>Tárolt adatok:
                <ul>
                    <li><code>previous_values</code> (JSON, update/delete esetén)</li>
                    <li><code>new_values</code> (JSON, create/update esetén)</li>
                    <li><code>user_id</code>, <code>company_id</code>, <code>created_at</code></li>
                </ul>
            </li>
        </ul>

        <h3>10.2. Hozzáférés</h3>
        <ul>
            <li>Jogosultság: <code>can_view_logs = true</code> (user_company_permissions)</li>
            <li>Vagy: <code>super_admin</code> role</li>
            <li>UI: Settings > Logs</li>
            <li>Szűrés: dátum, entitás típus, user</li>
        </ul>
    </div>

    <div class="section">
        <h2>11. DOKUMENTUMKEZELÉS <span class="status-icon orange">⚠</span></h2>

        <h3>11.1. Funkciók</h3>
        <ul class="feature-list">
            <li class="missing">File upload (Supabase Storage - <strong>nincs implementálva</strong>)</li>
            <li class="done">Metadata tárolás (title, description, file_path, mime_type, size)</li>
            <li class="done">Kapcsolódás: partner, project, sale</li>
            <li class="done">Visibility: private (csak owner company) / shared</li>
        </ul>

        <div class="warning-box">
            <strong>⚠️ Részleges implementáció:</strong> Csak metadata tárolás működik, nincs Supabase Storage integráció. A <code>file_path</code> mező üres, nincs upload/download funkció.
        </div>

        <h3>11.2. Jogosultságok <span class="status-icon green">✓</span></h3>
        <ul>
            <li>Company-based access (RLS)</li>
            <li>Viewer role: read-only</li>
            <li>Normal/Admin: full CRUD (+ can_delete flag)</li>
        </ul>
    </div>

    <div class="section">
        <h2>12. KÖLTSÉGKEZELÉS <span class="status-icon green">✓</span></h2>

        <h3>12.1. Funkciók</h3>
        <ul>
            <li>Projekt költségek nyilvántartása</li>
            <li>Multi-currency support</li>
            <li>Automatic HUF conversion (exchange_rates table)</li>
            <li>Számított mezők: <code>amount_huf = amount * rate</code></li>
        </ul>

        <h3>12.2. Exchange Rates</h3>
        <ul>
            <li>Manual entry (Settings > Exchange Rates)</li>
            <li>Daily rates</li>
            <li>Base: HUF</li>
            <li>Automatic lookup on cost save</li>
        </ul>
    </div>

    <div class="section">
        <h2>13. NAPTÁR <span class="status-icon green">✓</span></h2>

        <h3>13.1. Funkciók</h3>
        <ul>
            <li>Task deadline visualization</li>
            <li>Calendar view (react-day-picker)</li>
            <li>Filtered by: company, user, project, status</li>
        </ul>

        <h3>13.2. Integráció</h3>
        <ul>
            <li>Tasks table alapú</li>
            <li class="missing">Real-time update (<strong>nincs Supabase Realtime enabled</strong>)</li>
        </ul>
    </div>

    <div class="section">
        <h2>14. DASHBOARD <span class="status-icon green">✓</span></h2>

        <h3>14.1. Widgets</h3>
        <ul>
            <li>Recent tasks (my tasks + company tasks)</li>
            <li>Upcoming deadlines</li>
            <li>License status (expiration warning)</li>
            <li>Quick stats (projects, sales, partners count)</li>
        </ul>

        <h3>14.2. Personalizáció</h3>
        <ul>
            <li>User role alapú tartalmi szűrés</li>
            <li>Company context</li>
            <li>Language-specific labels</li>
        </ul>
    </div>

    <div class="section">
        <h2>15. RENDSZER BEÁLLÍTÁSOK <span class="status-icon green">✓</span></h2>

        <h3>15.1. Account Lock Settings</h3>
        <ul>
            <li><code>account_lock_attempts</code> (default: 5)</li>
            <li><code>account_lock_auto_unlock_minutes</code> (default: 30)</li>
            <li><code>account_lock_failed_attempts_window_minutes</code> (default: 15)</li>
        </ul>

        <h3>15.2. 2FA Settings</h3>
        <ul>
            <li><code>two_factor_session_duration_minutes</code> (default: 720)</li>
            <li><code>two_factor_max_attempts</code> (default: 10)</li>
            <li><code>two_factor_window_minutes</code> (default: 10)</li>
            <li><code>two_factor_lock_minutes</code> (default: 10)</li>
        </ul>

        <h3>15.3. UI</h3>
        <ul>
            <li>Settings > System Settings</li>
            <li>Super admin only</li>
            <li>Real-time update (immediate effect on new actions)</li>
        </ul>
    </div>

    <div class="section">
        <h2>16. DEPLOYMENT ÉS KÖRNYEZET <span class="status-icon green">✓</span></h2>

        <h3>16.1. Environment Variables</h3>
        <ul>
            <li><code>VITE_SUPABASE_URL</code> (auto-configured by Lovable Cloud)</li>
            <li><code>VITE_SUPABASE_PUBLISHABLE_KEY</code> (auto-configured)</li>
            <li><code>VITE_SUPABASE_PROJECT_ID</code> (auto-configured)</li>
        </ul>

        <h3>16.2. Edge Function Secrets</h3>
        <ul>
            <li><code>SUPABASE_URL</code></li>
            <li><code>SUPABASE_ANON_KEY</code></li>
            <li><code>SUPABASE_SERVICE_ROLE_KEY</code></li>
            <li><code>SUPABASE_DB_URL</code></li>
        </ul>

        <h3>16.3. Database Migrations</h3>
        <ul>
            <li>Located: <code>supabase/migrations/</code></li>
            <li>Auto-applied by Lovable Cloud</li>
            <li>Naming: <code>YYYYMMDDHHMMSS_description.sql</code></li>
        </ul>
    </div>

    <div class="section">
        <h2>17. TESTING & ACCEPTANCE CRITERIA <span class="status-icon green">✓</span></h2>

        <h3>17.1. Authentication Scenarios</h3>
        <ul class="feature-list">
            <li class="done">Login without 2FA → immediate access</li>
            <li class="done">Login with 2FA → requires TOTP/recovery</li>
            <li class="done">Failed login (5x) → account lock (30 min)</li>
            <li class="done">2FA failed (10x in 10min) → 2FA lock (10 min)</li>
            <li class="done">Password change → invalidate 2FA sessions</li>
            <li class="done">2FA disable → invalidate 2FA sessions</li>
        </ul>

        <h3>17.2. Authorization Scenarios</h3>
        <ul class="feature-list">
            <li class="done">Super admin → access to everything</li>
            <li class="done">Admin → access to assigned companies</li>
            <li class="done">Normal → access based on permissions</li>
            <li class="done">Viewer → read-only</li>
            <li class="done">Expired license → read-only mode</li>
            <li class="done">Seat limit → cannot add new ADMIN/NORMAL users</li>
        </ul>

        <h3>17.3. License Scenarios</h3>
        <ul class="feature-list">
            <li class="done">First company → auto trial license (14 days, 5 seats)</li>
            <li class="done">License activation → validates key, updates license</li>
            <li class="done">Seat limit enforcement → INSERT/UPDATE blocked on exceed</li>
            <li class="done">License expiration → warning banner, read-only after expiry</li>
        </ul>

        <h3>17.4. Security Scenarios</h3>
        <ul class="feature-list">
            <li class="done">RLS → users see only their company data</li>
            <li class="done">2FA bypass attempt (console) → fails (no INSERT policy)</li>
            <li class="done">Direct DB manipulation → fails (service role only)</li>
            <li class="done">Session hijacking → mitigated by 2FA session verification</li>
        </ul>
    </div>

    <div class="section">
        <h2>18. ISMERT LIMITÁCIÓK ÉS JÖVŐBELI FEJLESZTÉSEK</h2>

        <h3>18.1. Jelenlegi Limitációk</h3>

        <ul class="feature-list">
            <li class="missing">Supabase Storage nincs aktívan használva (<code>documents.file_path</code> empty)</li>
            <li class="missing">Email notifications nem konfiguráltak (<code>notify-account-lock</code> placeholder)</li>
            <li class="missing">Realtime nincs enabled (manual refresh szükséges)</li>
            <li class="missing">User deletion csak soft delete (<code>auth.users</code> nem törölhető Supabase limitáció)</li>
        </ul>

        <h3>18.2. Javasolt Továbbfejlesztések</h3>

        <ul class="feature-list">
            <li class="missing">File upload/download implementáció (Storage buckets)</li>
            <li class="missing">Email service integráció (SMTP vagy Supabase Email templates)</li>
            <li class="missing">Realtime subscriptions (task/project updates)</li>
            <li class="missing">Advanced reporting (charts, exports)</li>
            <li class="missing">API integráció (external CRM sync)</li>
            <li class="missing">Mobile app (React Native)</li>
        </ul>
    </div>

    <div class="section">
        <h2>19. ÖSSZEFOGLALÁS</h2>

        <div class="info-box">
            <strong>Implementáció státusz:</strong><br><br>
            
            <strong style="color: #28a745;">✓ Teljesen implementált modulok (95%):</strong><br>
            • Teljes 2FA rendszer (TOTP, recovery codes, session verification, rate limiting)<br>
            • Felhasználó- és jogosultságkezelés (RLS, roles, permissions)<br>
            • Vállalatkezelés + licencrendszer (seat management, trial, activation)<br>
            • Account lockout mechanizmus<br>
            • Partnerkezelés, Értékesítések, Projektek, Feladatok, Költségek<br>
            • Törzsadatok (Master Data) + i18n<br>
            • Audit Log (teljes naplózás)<br>
            • Rendszerbeállítások (system_settings)<br>
            • Edge Functions (7 db implementált)<br>
            • Frontend teljes (12 oldal + komponensek + hooks)<br><br>
            
            <strong style="color: #ffc107;">⚠ Részlegesen implementált (3%):</strong><br>
            • Dokumentumkezelés (metadata only, nincs file upload/download)<br>
            • Naptár (task-based, nincs realtime)<br><br>
            
            <strong style="color: #dc3545;">✗ Hiányzó funkciók (2%):</strong><br>
            • Supabase Storage aktív használata<br>
            • Email notifikációk (SMTP konfiguráció)<br>
            • Realtime subscriptions<br>
            • Advanced reporting/charts<br>
            • External API integrációk
        </div>

        <div class="status-box implemented">
            <span class="status-icon green">✓</span>
            <strong>A Mini CRM rendszer production-ready állapotban van.</strong><br>
            Minden core funkció működik, biztonságos, RLS védett, licenc limitált, audit log-gal ellátott.<br>
            A hiányzó funkciók (file upload, email, realtime) nem blocker-ek, hanem nice-to-have extrák.
        </div>
    </div>

    <div style="text-align: center; margin-top: 60px; padding: 20px; border-top: 2px solid #3498db;">
        <p><strong>Mini CRM - Teljes Rendszer Specifikáció v1.0</strong></p>
        <p>Generálva: 2025-11-30</p>
        <p style="color: #7f8c8d;">React + TypeScript + Lovable Cloud (Supabase)</p>
    </div>
</body>
</html>